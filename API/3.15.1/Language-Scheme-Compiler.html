<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Language.Scheme.Compiler</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><script src="haddock-util.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
window.onload = function () {pageLoad();setSynopsis("mini_Language-Scheme-Compiler.html");};
//]]>
</script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">husk-scheme-3.15.1: R5RS Scheme interpreter, compiler, and library.</p></div><div id="content"><div id="module-header"><table class="info"><tr><th>Portability</th><td>portable</td></tr><tr><th>Stability</th><td>experimental</td></tr><tr><th>Maintainer</th><td>github.com/justinethier</td></tr><tr><th>Safe Haskell</th><td>None</td></tr></table><p class="caption">Language.Scheme.Compiler</p></div><div id="description"><p class="caption">Description</p><div class="doc"><p>This module contains a Scheme to Haskell compiler which performs the following 
transformations:
</p><pre> Scheme AST (LispVal) =&gt; Haskell AST (HaskAST) =&gt; Compiled Code (String)
</pre><p>The GHC compiler is then used to create a native executable. At present, the 
focus has just been on creating a compiler that will generate correct, working 
code. Many optimizations could and need to be made for time and space...
</p><p>Note the following type is used for all functions generated by the compiler: 
</p><pre> compiledFunc :: 
   Env -&gt;                  -- Runtime Environment
   LispVal -&gt;              -- Continuation
   LispVal -&gt;              -- Value
   Maybe [LispVal] -&gt;      -- Additional arguments
   IOThrowsError LispVal   -- Result
</pre></div></div><div id="synopsis"><p id="control.syn" class="caption expander" onclick="toggleSection('syn')">Synopsis</p><ul id="section.syn" class="hide" onclick="toggleSection('syn')"><li class="src short"><a href="#v:compile">compile</a> :: <a href="Language-Scheme-Types.html#t:Env">Env</a> -&gt; <a href="Language-Scheme-Types.html#t:LispVal">LispVal</a> -&gt; <a href="Language-Scheme-Compiler-Types.html#t:CompOpts">CompOpts</a> -&gt; <a href="Language-Scheme-Types.html#t:IOThrowsError">IOThrowsError</a> [<a href="Language-Scheme-Compiler-Types.html#t:HaskAST">HaskAST</a>]</li><li class="src short"><a href="#v:compileApply">compileApply</a> :: <a href="Language-Scheme-Types.html#t:Env">Env</a> -&gt; <a href="Language-Scheme-Types.html#t:LispVal">LispVal</a> -&gt; <a href="Language-Scheme-Compiler-Types.html#t:CompOpts">CompOpts</a> -&gt; <a href="Language-Scheme-Types.html#t:IOThrowsError">IOThrowsError</a> [<a href="Language-Scheme-Compiler-Types.html#t:HaskAST">HaskAST</a>]</li><li class="src short"><a href="#v:compileBlock">compileBlock</a> :: String -&gt; Maybe String -&gt; <a href="Language-Scheme-Types.html#t:Env">Env</a> -&gt; [<a href="Language-Scheme-Compiler-Types.html#t:HaskAST">HaskAST</a>] -&gt; [<a href="Language-Scheme-Types.html#t:LispVal">LispVal</a>] -&gt; <a href="Language-Scheme-Types.html#t:IOThrowsError">IOThrowsError</a> [<a href="Language-Scheme-Compiler-Types.html#t:HaskAST">HaskAST</a>]</li><li class="src short"><a href="#v:compileDivertedVars">compileDivertedVars</a> :: String -&gt; <a href="Language-Scheme-Types.html#t:Env">Env</a> -&gt; [<a href="Language-Scheme-Types.html#t:LispVal">LispVal</a>] -&gt; <a href="Language-Scheme-Compiler-Types.html#t:CompOpts">CompOpts</a> -&gt; <a href="Language-Scheme-Types.html#t:IOThrowsError">IOThrowsError</a> <a href="Language-Scheme-Compiler-Types.html#t:HaskAST">HaskAST</a></li><li class="src short"><a href="#v:compileExpr">compileExpr</a> :: <a href="Language-Scheme-Types.html#t:Env">Env</a> -&gt; <a href="Language-Scheme-Types.html#t:LispVal">LispVal</a> -&gt; String -&gt; Maybe String -&gt; <a href="Language-Scheme-Types.html#t:IOThrowsError">IOThrowsError</a> [<a href="Language-Scheme-Compiler-Types.html#t:HaskAST">HaskAST</a>]</li><li class="src short"><a href="#v:compileLambdaList">compileLambdaList</a> :: [<a href="Language-Scheme-Types.html#t:LispVal">LispVal</a>] -&gt; <a href="Language-Scheme-Types.html#t:IOThrowsError">IOThrowsError</a> String</li><li class="src short"><a href="#v:compileLisp">compileLisp</a> :: <a href="Language-Scheme-Types.html#t:Env">Env</a> -&gt; String -&gt; String -&gt; Maybe String -&gt; <a href="Language-Scheme-Types.html#t:IOThrowsError">IOThrowsError</a> [<a href="Language-Scheme-Compiler-Types.html#t:HaskAST">HaskAST</a>]</li><li class="src short"><a href="#v:compileScalar">compileScalar</a> :: String -&gt; <a href="Language-Scheme-Compiler-Types.html#t:CompOpts">CompOpts</a> -&gt; <a href="Language-Scheme-Types.html#t:IOThrowsError">IOThrowsError</a> [<a href="Language-Scheme-Compiler-Types.html#t:HaskAST">HaskAST</a>]</li><li class="src short"><a href="#v:compileSpecialForm">compileSpecialForm</a> :: String -&gt; String -&gt; <a href="Language-Scheme-Compiler-Types.html#t:CompOpts">CompOpts</a> -&gt; <a href="Language-Scheme-Types.html#t:IOThrowsError">IOThrowsError</a> <a href="Language-Scheme-Compiler-Types.html#t:HaskAST">HaskAST</a></li><li class="src short"><a href="#v:compileSpecialFormBody">compileSpecialFormBody</a> :: <a href="Language-Scheme-Types.html#t:Env">Env</a> -&gt; <a href="Language-Scheme-Types.html#t:LispVal">LispVal</a> -&gt; <a href="Language-Scheme-Compiler-Types.html#t:CompOpts">CompOpts</a> -&gt; (Maybe String -&gt; ErrorT <a href="Language-Scheme-Types.html#t:LispError">LispError</a> IO [<a href="Language-Scheme-Compiler-Types.html#t:HaskAST">HaskAST</a>]) -&gt; ErrorT <a href="Language-Scheme-Types.html#t:LispError">LispError</a> IO [<a href="Language-Scheme-Compiler-Types.html#t:HaskAST">HaskAST</a>]</li><li class="src short"><a href="#v:compileSpecialFormEntryPoint">compileSpecialFormEntryPoint</a> :: String -&gt; String -&gt; <a href="Language-Scheme-Compiler-Types.html#t:CompOpts">CompOpts</a> -&gt; <a href="Language-Scheme-Types.html#t:IOThrowsError">IOThrowsError</a> <a href="Language-Scheme-Compiler-Types.html#t:HaskAST">HaskAST</a></li><li class="src short"><a href="#v:defineLambdaVars">defineLambdaVars</a> :: <a href="Language-Scheme-Types.html#t:Env">Env</a> -&gt; [<a href="Language-Scheme-Types.html#t:LispVal">LispVal</a>] -&gt; <a href="Language-Scheme-Types.html#t:IOThrowsError">IOThrowsError</a> <a href="Language-Scheme-Types.html#t:LispVal">LispVal</a></li><li class="src short"><a href="#v:defineTopLevelVars">defineTopLevelVars</a> :: <a href="Language-Scheme-Types.html#t:Env">Env</a> -&gt; [<a href="Language-Scheme-Types.html#t:LispVal">LispVal</a>] -&gt; <a href="Language-Scheme-Types.html#t:IOThrowsError">IOThrowsError</a> <a href="Language-Scheme-Types.html#t:LispVal">LispVal</a></li><li class="src short"><a href="#v:divertVars">divertVars</a> :: <a href="Language-Scheme-Types.html#t:Env">Env</a> -&gt; <a href="Language-Scheme-Types.html#t:LispVal">LispVal</a> -&gt; <a href="Language-Scheme-Compiler-Types.html#t:CompOpts">CompOpts</a> -&gt; (<a href="Language-Scheme-Types.html#t:Env">Env</a> -&gt; <a href="Language-Scheme-Types.html#t:LispVal">LispVal</a> -&gt; <a href="Language-Scheme-Compiler-Types.html#t:CompOpts">CompOpts</a> -&gt; <a href="Language-Scheme-Types.html#t:IOThrowsError">IOThrowsError</a> [<a href="Language-Scheme-Compiler-Types.html#t:HaskAST">HaskAST</a>]) -&gt; <a href="Language-Scheme-Types.html#t:IOThrowsError">IOThrowsError</a> [<a href="Language-Scheme-Compiler-Types.html#t:HaskAST">HaskAST</a>]</li><li class="src short"><a href="#v:initializeCompiler">initializeCompiler</a> :: <a href="Language-Scheme-Types.html#t:Env">Env</a> -&gt; <a href="Language-Scheme-Types.html#t:IOThrowsError">IOThrowsError</a> [<a href="Language-Scheme-Compiler-Types.html#t:HaskAST">HaskAST</a>]</li><li class="src short"><a href="#v:isPrim">isPrim</a> :: <a href="Language-Scheme-Types.html#t:Env">Env</a> -&gt; <a href="Language-Scheme-Types.html#t:LispVal">LispVal</a> -&gt; <a href="Language-Scheme-Types.html#t:IOThrowsError">IOThrowsError</a> (Maybe <a href="Language-Scheme-Types.html#t:LispVal">LispVal</a>)</li><li class="src short"><a href="#v:mcompile">mcompile</a> :: <a href="Language-Scheme-Types.html#t:Env">Env</a> -&gt; <a href="Language-Scheme-Types.html#t:LispVal">LispVal</a> -&gt; <a href="Language-Scheme-Compiler-Types.html#t:CompOpts">CompOpts</a> -&gt; <a href="Language-Scheme-Types.html#t:IOThrowsError">IOThrowsError</a> [<a href="Language-Scheme-Compiler-Types.html#t:HaskAST">HaskAST</a>]</li><li class="src short"><a href="#v:mfunc">mfunc</a> :: <a href="Language-Scheme-Types.html#t:Env">Env</a> -&gt; <a href="Language-Scheme-Types.html#t:LispVal">LispVal</a> -&gt; (<a href="Language-Scheme-Types.html#t:Env">Env</a> -&gt; <a href="Language-Scheme-Types.html#t:LispVal">LispVal</a> -&gt; <a href="Language-Scheme-Compiler-Types.html#t:CompOpts">CompOpts</a> -&gt; <a href="Language-Scheme-Types.html#t:IOThrowsError">IOThrowsError</a> [<a href="Language-Scheme-Compiler-Types.html#t:HaskAST">HaskAST</a>]) -&gt; <a href="Language-Scheme-Compiler-Types.html#t:CompOpts">CompOpts</a> -&gt; <a href="Language-Scheme-Types.html#t:IOThrowsError">IOThrowsError</a> [<a href="Language-Scheme-Compiler-Types.html#t:HaskAST">HaskAST</a>]</li></ul></div><div id="interface"><h1>Documentation</h1><div class="top"><p class="src"><a name="v:compile" class="def">compile</a> :: <a href="Language-Scheme-Types.html#t:Env">Env</a> -&gt; <a href="Language-Scheme-Types.html#t:LispVal">LispVal</a> -&gt; <a href="Language-Scheme-Compiler-Types.html#t:CompOpts">CompOpts</a> -&gt; <a href="Language-Scheme-Types.html#t:IOThrowsError">IOThrowsError</a> [<a href="Language-Scheme-Compiler-Types.html#t:HaskAST">HaskAST</a>]</p><div class="doc"><p>Compile a Lisp expression to Haskell. Note this function does
  not expand macros; mcompile should be used instead if macros
  may appear in the expression.
</p></div></div><div class="top"><p class="src"><a name="v:compileApply" class="def">compileApply</a> :: <a href="Language-Scheme-Types.html#t:Env">Env</a> -&gt; <a href="Language-Scheme-Types.html#t:LispVal">LispVal</a> -&gt; <a href="Language-Scheme-Compiler-Types.html#t:CompOpts">CompOpts</a> -&gt; <a href="Language-Scheme-Types.html#t:IOThrowsError">IOThrowsError</a> [<a href="Language-Scheme-Compiler-Types.html#t:HaskAST">HaskAST</a>]</p><div class="doc"><p>Compile a function call
</p></div></div><div class="top"><p class="src"><a name="v:compileBlock" class="def">compileBlock</a> :: String -&gt; Maybe String -&gt; <a href="Language-Scheme-Types.html#t:Env">Env</a> -&gt; [<a href="Language-Scheme-Compiler-Types.html#t:HaskAST">HaskAST</a>] -&gt; [<a href="Language-Scheme-Types.html#t:LispVal">LispVal</a>] -&gt; <a href="Language-Scheme-Types.html#t:IOThrowsError">IOThrowsError</a> [<a href="Language-Scheme-Compiler-Types.html#t:HaskAST">HaskAST</a>]</p><div class="doc"><p>Compile a list (block) of Scheme code
</p></div></div><div class="top"><p class="src"><a name="v:compileDivertedVars" class="def">compileDivertedVars</a> :: String -&gt; <a href="Language-Scheme-Types.html#t:Env">Env</a> -&gt; [<a href="Language-Scheme-Types.html#t:LispVal">LispVal</a>] -&gt; <a href="Language-Scheme-Compiler-Types.html#t:CompOpts">CompOpts</a> -&gt; <a href="Language-Scheme-Types.html#t:IOThrowsError">IOThrowsError</a> <a href="Language-Scheme-Compiler-Types.html#t:HaskAST">HaskAST</a></p><div class="doc"><p>Take a list of variables diverted into env at compile time, and
  divert them into the env at runtime
</p></div></div><div class="top"><p class="src"><a name="v:compileExpr" class="def">compileExpr</a> :: <a href="Language-Scheme-Types.html#t:Env">Env</a> -&gt; <a href="Language-Scheme-Types.html#t:LispVal">LispVal</a> -&gt; String -&gt; Maybe String -&gt; <a href="Language-Scheme-Types.html#t:IOThrowsError">IOThrowsError</a> [<a href="Language-Scheme-Compiler-Types.html#t:HaskAST">HaskAST</a>]</p><div class="doc"><p>Compile an intermediate expression (such as an arg to if) and 
   call into the next continuation with it's value
</p></div></div><div class="top"><p class="src"><a name="v:compileLambdaList" class="def">compileLambdaList</a> :: [<a href="Language-Scheme-Types.html#t:LispVal">LispVal</a>] -&gt; <a href="Language-Scheme-Types.html#t:IOThrowsError">IOThrowsError</a> String</p><div class="doc"><p>Compile the list of arguments for a function
</p></div></div><div class="top"><p class="src"><a name="v:compileLisp" class="def">compileLisp</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="Language-Scheme-Types.html#t:Env">Env</a></td><td class="doc"><p>Compiler environment 
</p></td></tr><tr><td class="src">-&gt; String</td><td class="doc"><p>Filename
</p></td></tr><tr><td class="src">-&gt; String</td><td class="doc"><p>Function entry point (code calls into this function)
</p></td></tr><tr><td class="src">-&gt; Maybe String</td><td class="doc"><p>Function exit point, if any
</p></td></tr><tr><td class="src">-&gt; <a href="Language-Scheme-Types.html#t:IOThrowsError">IOThrowsError</a> [<a href="Language-Scheme-Compiler-Types.html#t:HaskAST">HaskAST</a>]</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Compile a file containing scheme code
</p></div></div><div class="top"><p class="src"><a name="v:compileScalar" class="def">compileScalar</a> :: String -&gt; <a href="Language-Scheme-Compiler-Types.html#t:CompOpts">CompOpts</a> -&gt; <a href="Language-Scheme-Types.html#t:IOThrowsError">IOThrowsError</a> [<a href="Language-Scheme-Compiler-Types.html#t:HaskAST">HaskAST</a>]</p><div class="doc"><p>Helper function to compile expressions consisting of a scalar
</p></div></div><div class="top"><p class="src"><a name="v:compileSpecialForm" class="def">compileSpecialForm</a> :: String -&gt; String -&gt; <a href="Language-Scheme-Compiler-Types.html#t:CompOpts">CompOpts</a> -&gt; <a href="Language-Scheme-Types.html#t:IOThrowsError">IOThrowsError</a> <a href="Language-Scheme-Compiler-Types.html#t:HaskAST">HaskAST</a></p><div class="doc"><p>Helper function for compiling a special form
</p></div></div><div class="top"><p class="src"><a name="v:compileSpecialFormBody" class="def">compileSpecialFormBody</a> :: <a href="Language-Scheme-Types.html#t:Env">Env</a> -&gt; <a href="Language-Scheme-Types.html#t:LispVal">LispVal</a> -&gt; <a href="Language-Scheme-Compiler-Types.html#t:CompOpts">CompOpts</a> -&gt; (Maybe String -&gt; ErrorT <a href="Language-Scheme-Types.html#t:LispError">LispError</a> IO [<a href="Language-Scheme-Compiler-Types.html#t:HaskAST">HaskAST</a>]) -&gt; ErrorT <a href="Language-Scheme-Types.html#t:LispError">LispError</a> IO [<a href="Language-Scheme-Compiler-Types.html#t:HaskAST">HaskAST</a>]</p><div class="doc"><p>A wrapper for each special form that allows the form variable 
  (EG: <a href="if.html">if</a>) to be redefined at compile time
</p></div></div><div class="top"><p class="src"><a name="v:compileSpecialFormEntryPoint" class="def">compileSpecialFormEntryPoint</a> :: String -&gt; String -&gt; <a href="Language-Scheme-Compiler-Types.html#t:CompOpts">CompOpts</a> -&gt; <a href="Language-Scheme-Types.html#t:IOThrowsError">IOThrowsError</a> <a href="Language-Scheme-Compiler-Types.html#t:HaskAST">HaskAST</a></p><div class="doc"><p>Create the function entry point for a special form
</p></div></div><div class="top"><p class="src"><a name="v:defineLambdaVars" class="def">defineLambdaVars</a> :: <a href="Language-Scheme-Types.html#t:Env">Env</a> -&gt; [<a href="Language-Scheme-Types.html#t:LispVal">LispVal</a>] -&gt; <a href="Language-Scheme-Types.html#t:IOThrowsError">IOThrowsError</a> <a href="Language-Scheme-Types.html#t:LispVal">LispVal</a></p><div class="doc"><p>Add lambda variables to the compiler's environment
</p></div></div><div class="top"><p class="src"><a name="v:defineTopLevelVars" class="def">defineTopLevelVars</a> :: <a href="Language-Scheme-Types.html#t:Env">Env</a> -&gt; [<a href="Language-Scheme-Types.html#t:LispVal">LispVal</a>] -&gt; <a href="Language-Scheme-Types.html#t:IOThrowsError">IOThrowsError</a> <a href="Language-Scheme-Types.html#t:LispVal">LispVal</a></p><div class="doc"><p>Find all variables defined at <a href="this.html">this</a> level and load their symbols into
  the environment. This allows the compiler validation to work even 
  though a variable is used in a sub-form before it is defined further
  on down in the program
</p></div></div><div class="top"><p class="src"><a name="v:divertVars" class="def">divertVars</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="Language-Scheme-Types.html#t:Env">Env</a></td><td class="doc"><p>Current compile Environment
</p></td></tr><tr><td class="src">-&gt; <a href="Language-Scheme-Types.html#t:LispVal">LispVal</a></td><td class="doc"><p>Lisp code after macro expansion
</p></td></tr><tr><td class="src">-&gt; <a href="Language-Scheme-Compiler-Types.html#t:CompOpts">CompOpts</a></td><td class="doc"><p>Compiler options
</p></td></tr><tr><td class="src">-&gt; (<a href="Language-Scheme-Types.html#t:Env">Env</a> -&gt; <a href="Language-Scheme-Types.html#t:LispVal">LispVal</a> -&gt; <a href="Language-Scheme-Compiler-Types.html#t:CompOpts">CompOpts</a> -&gt; <a href="Language-Scheme-Types.html#t:IOThrowsError">IOThrowsError</a> [<a href="Language-Scheme-Compiler-Types.html#t:HaskAST">HaskAST</a>])</td><td class="doc"><p>Continuation to call into after vars are diverted
</p></td></tr><tr><td class="src">-&gt; <a href="Language-Scheme-Types.html#t:IOThrowsError">IOThrowsError</a> [<a href="Language-Scheme-Compiler-Types.html#t:HaskAST">HaskAST</a>]</td><td class="doc"><p>Code generated by the continuation, along with the code
   added to divert vars to the compiled program
</p></td></tr></table></div><div class="doc"><p>Do the actual insertion of diverted variables back to the 
  compiled program.
</p></div></div><div class="top"><p class="src"><a name="v:initializeCompiler" class="def">initializeCompiler</a> :: <a href="Language-Scheme-Types.html#t:Env">Env</a> -&gt; <a href="Language-Scheme-Types.html#t:IOThrowsError">IOThrowsError</a> [<a href="Language-Scheme-Compiler-Types.html#t:HaskAST">HaskAST</a>]</p><div class="doc"><p>Perform one-time initialization of the compiler's environment
</p></div></div><div class="top"><p class="src"><a name="v:isPrim" class="def">isPrim</a> :: <a href="Language-Scheme-Types.html#t:Env">Env</a> -&gt; <a href="Language-Scheme-Types.html#t:LispVal">LispVal</a> -&gt; <a href="Language-Scheme-Types.html#t:IOThrowsError">IOThrowsError</a> (Maybe <a href="Language-Scheme-Types.html#t:LispVal">LispVal</a>)</p><div class="doc"><p>Determines if the given lispval is a primitive function
</p></div></div><div class="top"><p class="src"><a name="v:mcompile" class="def">mcompile</a> :: <a href="Language-Scheme-Types.html#t:Env">Env</a> -&gt; <a href="Language-Scheme-Types.html#t:LispVal">LispVal</a> -&gt; <a href="Language-Scheme-Compiler-Types.html#t:CompOpts">CompOpts</a> -&gt; <a href="Language-Scheme-Types.html#t:IOThrowsError">IOThrowsError</a> [<a href="Language-Scheme-Compiler-Types.html#t:HaskAST">HaskAST</a>]</p><div class="doc"><p>Expand macros and compile the resulting code
</p></div></div><div class="top"><p class="src"><a name="v:mfunc" class="def">mfunc</a> :: <a href="Language-Scheme-Types.html#t:Env">Env</a> -&gt; <a href="Language-Scheme-Types.html#t:LispVal">LispVal</a> -&gt; (<a href="Language-Scheme-Types.html#t:Env">Env</a> -&gt; <a href="Language-Scheme-Types.html#t:LispVal">LispVal</a> -&gt; <a href="Language-Scheme-Compiler-Types.html#t:CompOpts">CompOpts</a> -&gt; <a href="Language-Scheme-Types.html#t:IOThrowsError">IOThrowsError</a> [<a href="Language-Scheme-Compiler-Types.html#t:HaskAST">HaskAST</a>]) -&gt; <a href="Language-Scheme-Compiler-Types.html#t:CompOpts">CompOpts</a> -&gt; <a href="Language-Scheme-Types.html#t:IOThrowsError">IOThrowsError</a> [<a href="Language-Scheme-Compiler-Types.html#t:HaskAST">HaskAST</a>]</p><div class="doc"><p>Expand macros and then pass control to the given function 
</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.13.2</p></div></body></html>